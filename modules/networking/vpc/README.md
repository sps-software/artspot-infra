# VPC Module

## Overview
Inputs:

```
module "main_vpc" {
  source = ...
  aws_region = "" // optional (default: "us-east-2") 
  name = ""// required
  assign_generated_ipv6_cidr_block // optional (default false)
  vpc_cidr_block = "" // optional (default: "10.0.0.0/16")
  num_public_subnets = 2 // optional (default: 1)
  num_private_subnets = 2 // optional (default: 1)
  instance_tenancy = "" // optional (default:  "default")
  environment = "" // optional (default: "")
  subnet_cidr_block_ext = "" // optional (default: "24")
  subnet_cidr_blocks = [""] // optional: (default: generated from vpc cidr block)
  subnet_ipv6_cidr_blocks = [""] // optional: (default: [])
  subnet_names = [""] // optional: (default generated, see format) 
  assign_subnets_ipv6_address_on_creation = // optional (default: false)
  internet_gateway_enabled = true // optional (default: true)
  custom_route_table_enabled = true // optional (default: true)
  route_table_igw_cidr_block = "" // optional (default: "0.0.0.0/0" 
}
```

This module will build a VPC with a specified number of public and private subnets, as well as an internet gateway and a custom route table if desired. Subnet ids, arns, and other variables are available as output lists as well a mappings. e.g.

```
module.this.public_subnet_ids = [
  "subnet-abcd"
]

module.this.private_subnet_ids = [
  "subnet-efgh"
]

module.this.subnet_name_id_map = {
  "main-vpc-public-subnet-0-us-east-2a-prod" = "subnet-abcd",
  "main-vpc-private-subnet-1-us-east-2b-prod" = "subnet-efgh"
}

module.this.subnet_name_arn_map = { 
  "main-vpc-public-subnet-0-us-east-2a-prod" = "arn:aws:ec2:us-east-2:xxxxxxxxxxxx:subnet/subnet-abcd",
  "main-vpc-private-subnet-1-us-east-2b-prod" = "arn:aws:ec2:us-east-2:xxxxxxxxxxxx:subnet/subnet-efgh"
}

module.this.subnet_id_arn_map = {
  "subnet-abdc" = "arn:aws:ec2:us-east-2:xxxxxxxxxxxx:subnet/subnet-abdc",
  "subnet-efgh" = "arn:aws:ec2:us-east-2:xxxxxxxxxxxx:subnet/subnet-efgh"
}
```

Subnet naming convention is as follows: 
`"{vpc name}-{private/public}-subnet-{subnet index}-{availability zone}-{optional environment extension}"`

You can override this with a list of subnet names equal to the amount of subnets using the variable `subnet_names`. Public subnets are created first, so if you want to override subnets with names specific to whether they are public or private, include public names first. i.e. If you have 5 subnets, and 3 public subnets your list would look like this:

```["public-a", "public-b", "public-c", "private-a", "private-b"]```

Subnet ipv4 cidr blocks are generated by incrementing the third section of the vpc cidr block. For example:

```
module "main_vpc" {
  source = "path/to/modules/vpc"
  aws_region = var.aws_region
  name = "main-vpc"
  vpc_cidr_block = "178.222.123.091/16"
  num_public_subnets = 2
  num_private_subnets = 2
}
```

Would output the following subnet cider blocks (the extension defaults to 24):

```
["178.222.123.091/24", "178.222.124.091/24", "178.222.125.091/24", "178.222.126.091/24"]
```

This would obviously break if your third section of your cider block plus the number of subnets is greater than 254. If you use a custom extension with the `subnet_cidr_block_ext` variable, it should also be within the range of your vpc's cidr extension as well.

Alternatively, you can override subnet cidr blocks with a custom list using the `subnet_cidr_blocks` variable, however the length must be equal to the amount of public and private subnets configured. You may also assign vpv6 cidr blocks, but all subnet sizes must use a /64 prefix length. This will have to be updated after generating the vpc as you will not know the ipv6 cidr block aws will assign you.

The route table has a default route for your internet gateway set to cidr block: "0.0.0.0/0" for general access. If you would not like to add a nat gateway or a custom route table, set both counts to zero (both must be set or not set). you can optionally override the route table internet gateway cidr block with the `route_table_igw_cidr_block` variable.

You can provide an optional environment variable, which will be appended to all name tags with a hyphen.

For example:  environment_variable: "prod" would result in:

```
resource "aws_vpc" "this" {
  ...
  tags = {
    Name = "main-vpc-prod"
  }
}
```

